<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<izpack:installation version="5.0"
                     xmlns:izpack="http://izpack.org/schema/installation"
                     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                     xsi:schemaLocation="http://izpack.org/schema/installation http://izpack.org/schema/5.0/izpack-installation-5.0.xsd">

    <info>
        <appname>@{appname}</appname>
        <appversion>@{version}</appversion>
        <javaversion>1.8</javaversion>
        <requiresjdk>false</requiresjdk>
        <appsubpath>Deltix</appsubpath>
        <summarylogfilepath>${INSTALL_PATH}/installinfo/summary.htm</summarylogfilepath>
        <readinstallationinformation>false</readinstallationinformation>
        <writeinstallationinformation>false</writeinstallationinformation>
        <run-privileged condition="izpack.windowsinstall"/>
    </info>

    <logging>
        <log-file pattern="${INSTALL_PATH}/install.log" level="ALL" append="true" count="100"/>
    </logging>

    <guiprefs height="470" width="630" resizable="yes">
        <!-- TODO: do we need plashscreen for installer -->
        <!--<modifier key="useSplashScreen" value="2000"/>-->

        <modifier key="useButtonIcons" value="no"/>
        <modifier key="useLabelIcons" value="no"/>
        <modifier key="layoutAnchor" value="EAST"/>
        <modifier key="useHeadingPanel" value="yes"/>
        <modifier key="headingImageOnLeft" value="yes"/>
        <modifier key="headingLineCount" value="1"/>
        <modifier key="headingFontSize" value="1.5"/>
        <modifier key="headingForegroundColor" value="0x00ffffff"/>
        <modifier key="headingBackgroundColor" value="0x001e64b4"/>

        <modifier key="showDebugWindow" value="true"/>
    </guiprefs>

    <locale>
        <langpack iso3="eng"/>
    </locale>

    <resources>
        <res id="Splash.image" src="@{izpack.resources.path}/splash.png"/>
        <res id="Installer.image" src="@{izpack.resources.path}/deltix_logo.png"/>
        <res id="customicons.xml" src="@{izpack.resources.path}/icons.xml"/>
        <res id="JFrameIcon.png" src="@{izpack.resources.path}/install.png"/>

        <res id="CustomLangPack.xml_eng" src="@{izpack.resources.path}/langpack.xml_eng"/>
        <res id="HTMLHelloPanel.welcome" src="@{izpack.resources.path}/welcome.html"/>
        <res id="HTMLLicencePanel.license" src="@{izpack.resources.path}/license.html"/>

        <res id="userInputSpec.xml" src="@{izpack.resources.path}/userPanels.xml" parse="yes" type="xml"/>
        <res id="userInputLang.xml_eng" src="@{izpack.resources.path}/userInputLang.xml_eng" />

        <res id="packsLang.xml_eng" src="@{izpack.resources.path}/packsLang.xml_eng"/>

        <res id="Win_shortcutSpec.xml" src="@{izpack.resources.path}/windows/shortcutSpec.xml"/>
        <res id="Unix_shortcutSpec.xml" src="@{izpack.resources.path}/linux/shortcutSpec.xml"/>
    </resources>

    <!-- default variables -->
    <variables>
        <variable name="TargetPanel.dir.unix" value="/opt/deltix"/>

        <variable name="compiledPlatform" value="@{compiledPlatform}"/>
        <variable name="version" value="@{version}"/>
        <variable name="offline" value="@{offline}"/>
        <variable name="skipLicenseCheck" value="@{skipLicenseCheck}"/>
        <variable name="qoExpress" value="@{qoExpress}"/>
        <variable name="qs.appname" value="@{qs.appname}"/>
        <variable name="qo.appname" value="@{qo.appname}"/>
        <variable name="qs.version" value="@{qs.version}"/>
        <variable name="qo.version" value="@{qo.version}"/>
        <variable name="izpack.resources.path" value="@{izpack.resources.path}"/>
        <variable name="izpack.generated.path" value="@{izpack.generated.path}"/>

        <variable name="qo.min.dotnet.version" value="@{qo.min.dotnet.version}"/>

        <variable name="qs.error" value=""/>
        <variable name="qo.error" value=""/>
        <variable name="qs.license.error" value=""/>
        <variable name="qo.license.error" value=""/>
        <variable name="qs.requirements.error" value=""/>
        <variable name="qo.requirements.error" value=""/>

        <!-- default install.properties -->
        <variable name="SerialProperties.serial" value=""/>
        <variable name="SerialProperties.useProxy" value="false"/>
        <variable name="SerialProperties.proxyHost" value=""/>
        <variable name="SerialProperties.proxyPort" value="433"/>
        <variable name="SerialProperties.proxyAuth" value="false"/>
        <variable name="SerialProperties.proxyUsername" value=""/>
        <variable name="SerialProperties.proxyPassword" value=""/>
        <variable name="InstallationNameProperties.instName" value=""/>
        <variable name="SelectComponentsPropertiesWindows.QuantServer" value="yes"/>

        <!-- other vars -->
        <variable name="SERVER_JAVA_OPTIONS" value="-Xmx1000m"/>
        <variable name="CLIENT_JAVA_OPTIONS" value="-Xmx1000m"/>

        <variable name="DesktopShortcutCheckboxEnabled" value="true"/>
        <variable name="ApplicationShortcutPath" value="temp/ApplicationShortcuts"/>
    </variables>

    <dynamicvariables>
        <variable name="platform" value="windows" condition="izpack.windowsinstall"/>
        <variable name="platform" value="linux" condition="izpack.linuxinstall"/>
        <variable name="platform" value="macOS" condition="izpack.macinstall"/>
        <variable name="platform" value="solaris" condition="izpack.solarisinstall"/>
        <variable name="platform" value="aix" condition="izpack.aixinstall"/>
        <variable name="isPlatform64" value="true"/>

        <!-- group name properties -->
        <variable name="defaultGroupName" value="${qo.appname} ${InstallationNameProperties.instName}" condition="!defaultInstallationName"/>
        <variable name="defaultGroupName" value="${qo.appname}" condition="defaultInstallationName"/>
        <variable name="qo.shortcut.suffix.property" value="suffix=${InstallationNameProperties.instName}" condition="!defaultInstallationName"/>
        <variable name="qo.shortcut.suffix.property" value="" condition="defaultInstallationName"/>

        <!-- install and inst properties -->
        <variable name="InstDataProperties.instFolder" value="${INSTALL_PATH}"/>
        <variable name="serial" value="${SerialProperties.serial}"/>

        <variable name="SERVER_JAVA_OPTIONS" value="-Xmx3072m" condition="platform64"/>
        <variable name="SERVER_JAVA_OPTIONS" value="-Xmx512m" condition="vista32"/>
        <variable name="SERVER_JAVA_OPTIONS" value="-Xmx1024m" condition="platform32"/>
        <variable name="CLIENT_JAVA_OPTIONS" value="-Xmx1500m" condition="platform64"/>
        <variable name="CLIENT_JAVA_OPTIONS" value="-Xmx512m" condition="platform32"/>
    </dynamicvariables>

    <conditions>
        <!-- OS conditions -->
        <condition type="variable" id="platform64">
            <name>isPlatform64</name>
            <value>true</value>
        </condition>
        <condition type="variable" id="platform32">
            <name>isPlatform64</name>
            <value>false</value>
        </condition>
        <condition type="and" id="vista32">
            <condition type="ref" refid="platform32"/>
            <condition type="ref" refid="izpack.windowsinstall.vista"/>
        </condition>

        <!-- user input conditions for custom panels -->
        <condition type="variable" id="useHTTPProxy">
            <name>SerialProperties.useProxy</name>
            <value>true</value>
        </condition>
        <condition type="variable" id="requireAuthentication">
            <name>SerialProperties.proxyAuth</name>
            <value>true</value>
        </condition>
        <condition type="and" id="useHTTPProxyAuthentication">
            <condition type="ref" refid="useHTTPProxy"/>
            <condition type="ref" refid="requireAuthentication"/>
        </condition>

        <condition type="empty" id="defaultInstallationName">
            <variable>InstallationNameProperties.instName</variable>
        </condition>

        <!-- pack conditions -->
        <condition type="variable" id="isOffline">
            <name>offline</name>
            <value>true</value>
        </condition>
        <condition type="variable" id="checkLicense">
            <name>skipLicenseCheck</name>
            <value>false</value>
        </condition>
        <condition type="empty" id="emptyQsError">
            <variable>qs.error</variable>
        </condition>
        <condition type="empty" id="emptyQoError">
            <variable>qo.error</variable>
        </condition>

        <condition type="or" id="qsNoError">
            <condition type="ref" refid="isOffline"/>
            <condition type="ref" refid="emptyQsError"/>
        </condition>
        <condition type="or" id="qoNoError">
            <condition type="ref" refid="isOffline"/>
            <condition type="ref" refid="emptyQoError"/>
        </condition>
    </conditions>

    <!-- jars with custom panels logic -->
    <jar src="@{panels.jar}" stage="install"/>

    <!-- external dll for shortcuts logic -->
    <natives>
        <native type="izpack" name="ShellLink.dll"/>
        <native type="izpack" name="ShellLink_x64.dll"/>
    </natives>

    <!-- list of panels -->
    <panels>
        <panel classname="com.epam.deltix.izpack.panels.properties.InitPanel" id="welcome"/>
        <panel classname="com.epam.deltix.izpack.panels.license.HTMLLicencePanel" id="license"/>
        <panel classname="com.epam.deltix.izpack.panels.target.CheckedTargetPanel" id="install_dir"/>

        <panel classname="com.epam.deltix.izpack.panels.license.CheckLicensePanel" id="serialPanel" condition="checkLicense"/>
        <panel classname="UserInputPanel" id="installationNamePanel"/>
        <panel classname="deltix.izpack.panels.requirements.RequirementsPanel" id="checkRequirements"/>

        <panel classname="PacksPanel" id="packsSelection"/>
        <panel classname="com.epam.deltix.izpack.panels.properties.StorePropertiesPanel" id="storeProperties"/>
        <panel classname="InstallPanel" id="install"/>
        <panel classname="com.epam.deltix.izpack.panels.shortcuts.ShortcutPanel" id="shortcuts"/>
        <panel classname="com.epam.deltix.izpack.panels.finish.FinishPanel" id="finish"/>
    </panels>

    <!-- modules to install -->
    <packs>
        @{packs}
    </packs>
</izpack:installation>
